# Система уведомлений

Новая административная панель для управления автоматическими уведомлениями с поддержкой cron-расписания.

## Возможности

- ✅ Создание, редактирование и удаление уведомлений
- ✅ Поддержка ежедневных, еженедельных и ежемесячных уведомлений
- ✅ Настраиваемое время отправки
- ✅ Выбор получателей из списка ShopContractorChats
- ✅ Активация/деактивация уведомлений
- ✅ Автоматическое планирование с помощью Quartz Scheduler
- ✅ Заглушка для отправки (вывод в консоль)

## Установка

### 1. База данных

Выполните SQL скрипт `backend/notifications_tables.sql` в вашей базе данных для создания необходимых таблиц:

```sql
-- Основные таблицы
- Notifications - хранит информацию об уведомлениях
- NotificationRecipients - связывает уведомления с получателями
```

### 2. Backend

Зависимости уже добавлены в `pom.xml`:
- `spring-boot-starter-quartz` - для планирования задач

### 3. Frontend

Новые файлы:
- `src/pages/Notifications.jsx` - главная страница управления
- `src/pages/NotificationForm.jsx` - форма создания/редактирования
- `src/api/notificationApi.js` - API клиент

## Использование

### Доступ к функциональности

1. Войдите в систему как администратор (`RetailAdmin`)
2. В боковом меню выберите "Уведомления" (иконка колокольчика)

### Создание уведомления

1. Нажмите кнопку "Создать уведомление"
2. Заполните форму:
   - **Заголовок** (обязательно) - краткое описание уведомления
   - **Сообщение** - текст уведомления
   - **Тип расписания**:
     - Ежедневно - каждый день в указанное время
     - Еженедельно - в определенный день недели
     - Ежемесячно - в определенный день месяца
     - Пользовательское - cron выражение
   - **Время** - час и минута отправки
   - **Получатели** - выберите чаты для отправки
   - **Активно** - включить/выключить уведомление

### Примеры расписания

- **Ежедневно в 9:00**: `0 9 * * *`
- **Еженедельно по понедельникам в 10:30**: `30 10 * * 1`
- **Ежемесячно 1 числа в 8:00**: `0 8 1 * *`

### Управление уведомлениями

- **Редактирование**: нажмите иконку карандаша
- **Удаление**: нажмите иконку корзины
- **Фильтрация**: используйте фильтр по статусу (Все/Активные/Неактивные)

## Техническая информация

### API Endpoints

```
GET    /api/admin/notifications          - Получить список уведомлений
POST   /api/admin/notifications          - Создать уведомление
GET    /api/admin/notifications/{id}     - Получить уведомление по ID
PUT    /api/admin/notifications/{id}     - Обновить уведомление
DELETE /api/admin/notifications/{id}     - Удалить уведомление
```

### Cron выражения

Формат: `минута час день_месяца месяц день_недели`

- `*` - любое значение
- `0-59` - минуты
- `0-23` - часы
- `1-31` - дни месяца
- `1-12` - месяцы
- `0-6` - дни недели (0 = воскресенье)

### Отправка уведомлений

В текущей реализации уведомления выводятся в консоль backend'а в формате:

```
=== ОТПРАВКА УВЕДОМЛЕНИЯ ===
Получатель (ShopContractorChatID): 123
Заголовок: Напоминание о проверке
Сообщение: Не забудьте выполнить еженедельную проверку
============================
```

Для интеграции с реальной системой отправки (Telegram Bot, Email и т.д.) 
измените метод `sendNotificationToChats` в классе `NotificationJob`.

### Планировщик

- Уведомления автоматически планируются при создании/обновлении
- При запуске приложения все активные уведомления загружаются в планировщик
- Неактивные уведомления автоматически удаляются из планировщика

## Безопасность

- Доступ только для пользователей с ролью `RetailAdmin`
- Валидация cron выражений на backend и frontend
- Проверка существования получателей

## Логирование

Все операции планировщика логируются:
- Планирование уведомлений
- Отмена планирования
- Выполнение отправки
- Ошибки планировщика
